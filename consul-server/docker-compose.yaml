---
services:
  consul:
    image: hashicorp/consul:1.20
    container_name: consul
    restart: unless-stopped
    network_mode: host
    volumes:
      - consul-data:/consul/data
      - ./consul.d:/consul/config:ro
    command: agent -server -bootstrap-expect=1 -ui -config-dir=/consul/config
    environment:
      CONSUL_BIND_INTERFACE: eth0

  registrator:
    image: gliderlabs/registrator:latest
    container_name: registrator
    restart: unless-stopped
    network_mode: host
    depends_on:
      - consul
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro
    command: -internal=false -explicit=true -cleanup -tags=kubernetes consul://localhost:8500

volumes:
  consul-data:
